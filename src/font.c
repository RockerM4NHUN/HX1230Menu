
#include "font.h"

const uint8_t charset[] = {
0x00,0x00,0x00,				/*" ",0*/
0x00,0x5e,0x00,				/*"!",1*/
0x00,0x06,0x00,0x06,		/*""",2*/
0x14,0x7E,0x14,0x7E,0x14,	/*"#",3*/
0x24,0x4A,0xFF,0x52,0x24,	/*"$",4*/
0x4E,0x2A,0x7E,0x54,0x72,	/*"%",5*/
0x34,0x4A,0x5A,0x24,0x50,	/*"&",6*/
0x00,0x00,0x06,0x00,		/*"'",7*/
0x3C,0x42,0x81,				/*"(",8*/
0x81,0x42,0x3C,				/*")",9*/
0x2A,0x1C,0x08,0x1C,0x2A,	/*"*",10*/
0x08,0x08,0x3E,0x08,0x08,	/*"+",11*/
0xC0,0x40,0x00,				/*",",12*/
0x08,0x08,0x08,0x08,		/*"-",13*/
0x00,0x40,0x00,				/*".",14*/
0x40,0x30,0x0C,0x02,		/*"/",15*/
0x3C,0x4A,0x52,0x3C,		/*"0",16*/
0x44,0x7E,0x40,				/*"1",17*/
0x64,0x52,0x4A,0x44,		/*"2",18*/
0x24,0x42,0x4A,0x3C,		/*"3",19*/
0x30,0x28,0x24,0x7E,		/*"4",20*/
0x2E,0x4A,0x4A,0x32,		/*"5",21*/
0x3C,0x52,0x52,0x24,		/*"6",22*/
0x02,0x72,0x0A,0x06,		/*"7",23*/
0x34,0x4A,0x4A,0x34,		/*"8",24*/
0x24,0x4A,0x4A,0x3C,		/*"9",25*/
0x00,0x24,0x00,				/*":",26*/
0xC4,0x40,0x00,				/*";",27*/
0x08,0x14,0x14,0x22,		/*"<",28*/
0x14,0x14,0x14,0x14,		/*"=",29*/
0x22,0x14,0x14,0x08,		/*">",30*/
0x04,0x52,0x0A,0x04,		/*"?",31*/
0x3C,0x42,0x5A,0x56,0x5C,	/*"@",32*/
0x7C,0x12,0x12,0x7C,		/*"A",33*/
0x7E,0x4A,0x4A,0x34,		/*"B",34*/
0x3C,0x42,0x42,0x24,		/*"C",35*/
0x7E,0x42,0x42,0x3C,		/*"D",36*/
0x7E,0x4A,0x4A,0x42,		/*"E",37*/
0x7E,0x0A,0x0A,0x02,		/*"F",38*/
0x3C,0x42,0x52,0x34,		/*"G",39*/
0x7E,0x08,0x08,0x7E,		/*"H",40*/
0x42,0x7E,0x42,0x00,		/*"I",41*/
0x20,0x40,0x40,0x3E,		/*"J",42*/
0x7E,0x08,0x14,0x62,		/*"K",43*/
0x7E,0x40,0x40,0x40,		/*"L",44*/
0x7E,0x04,0x08,0x04,0x7E,	/*"M",45*/
0x7E,0x08,0x10,0x7E,		/*"N",46*/
0x3C,0x42,0x42,0x3C,		/*"O",47*/
0x7E,0x12,0x12,0x0C,		/*"P",48*/
0x3C,0x42,0x62,0xBC,		/*"Q",49*/
0x7E,0x12,0x12,0x6C,		/*"R",50*/
0x24,0x4A,0x52,0x24,		/*"S",51*/
0x02,0x02,0x7E,0x02,0x02,	/*"T",52*/
0x3E,0x40,0x40,0x3E,		/*"U",53*/
0x1E,0x20,0x40,0x20,0x1E,	/*"V",54*/
0x3E,0x40,0x38,0x40,0x3E,	/*"W",55*/
0x66,0x18,0x18,0x66,		/*"X",56*/
0x06,0x08,0x70,0x08,0x06,	/*"Y",57*/
0x62,0x52,0x4A,0x46,		/*"Z",58*/

0x00
};

const int8_t offsets[] = {
 0, 0,
 1,-1,
 2,-2,
 4,-1,
 5, 0,
 6, 1,
 7, 2,
 9, 1,
10, 0,
11, 1,
12, 2,
13, 1,
15, 0,
18,-1,
27,-2,
28,-3,
33,-2,
46,-1,
53, 0,
55, 1,
56, 2,
58, 3,
127,-128
};

int8_t getOffset(uint8_t code){
    uint8_t i = 0;
    while(offsets[i] <= code){
        i += 2;
    }
    i -= 2;
    return offsets[i+1];
}

/* if data is NULL only the length will be returned */
/* otherwise data is handled as a pointers mem address*/
/* returns the number of bytes length */
uint8_t getCharData(char ascii, const uint8_t** data){
	if (ascii >= 'a' && ascii <= 'z'){
		ascii = ascii - 'a' + 'A';
	} else if (ascii > 'Z' || ascii < ' '){
		ascii = '?';
	}
    uint8_t code = ascii-' ';                       // normalize to charset code
    uint8_t offset = getOffset(code) + code * 4;    // get offset in charset
    uint8_t length = getOffset(code+1) + (code + 1) * 4 - offset;
    if (data != 0){
        *data = charset+offset;
    }
    return length;
}
